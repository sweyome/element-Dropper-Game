<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <script src="index.js"></!-->
    <link rel="stylesheet" href="style.css">
    <title>Element dropper Game</title>
</head>
<body>
    <div class="topbar">score : <span class="score">0</span>
        Enemy Left: <span class="badLeft">0</span>
    </div>
    <div class="container">
        <!-- Game area -->
        <div class="message">Press Here To Begin</div>
        <div class="btn">Start Button</div>
        <div class="basket"></div>
    </div>
    <script>
        const message = document.querySelector('.message');
        const scoreOutput = document.querySelector(".score");
        const badLeft = document.querySelector(".badLeft");
        const btn = document.querySelector(".btn");
        const basket = document.querySelector(".basket");
        const container = document.querySelector(".container")
        let boundBasket = basket.getBoundingClientRect();
        let boundContainer = container.getBoundingClientRect();

        let keys = {
            ArrowUp:false,
            ArrowDown:false,
            ArrowLeft:false,
            ArrowRight:false
        }
        let player = {
            score: 0,
            totalBad:0,
            inPlay: false,
            speed:15
        };

        btn.addEventListener('click', startGame);
        document.addEventListener("keydown", pressKeyOn);
        document.addEventListener("keyup", pressKeyOff);


        function startGame() {
            message.style.display = "none";
            btn.style.display = "none";
            player.score = 0;
            player.totalBad = 10;
            player.inPlay = true;
            scoreupdate();
            setupBadGuys(6);
            //! create bad Guys
            requestAnimationFrame(playGame);
        }
        function setupBadGuys(num){
            for(let x=0; x<num; x++){
                makeBad()
            }
        }
        function makeBad(){
            if(player.totalBad > 0){
                let temp = player.totalBad;
                player.totalBad--;
                scoreupdate();
                let div = document.createElement("div");
                div.innerHTML = "#"+temp;
                div.classList.add("baddy");
                div.x = Math.floor(Math.random()* boundContainer.width-100);
                if(div.x <0) div.x = 100;
                div.y = (Math.floor(Math.random() * 500)* -1)-200;
                div.speed= Math.ceil(Math.random()*10) +3;
                container.appendChild(div);
                div.style.left= div.x + "px";
                div.style.top= div.y + "px";
            }
        }

        function playGame(){
            if(player.inPlay == true){
                if(keys.ArrowDown && boundBasket.y < (boundContainer.height - boundBasket.height) ){
                    boundBasket.y += player.speed;
                }
                if(keys.ArrowUp && boundBasket.y>0){
                    boundBasket.y -= player.speed;
                }
                if(keys.ArrowLeft && boundBasket.x>0){
                    boundBasket.x -= player.speed;
                }
                if(keys.ArrowRight && boundBasket.x < (boundContainer.width - boundBasket.width)){
                    boundBasket.x += player.speed;
                }
                basket.style.left = boundBasket.x + "px";
                basket.style.top = boundBasket.y + "px";
                requestAnimationFrame(playGame);

                let tempEnemy = document.querySelectorAll(".baddy");
                if(tempEnemy.length == 0){
                    // end the Game
                }else{
                    for(let i=0;i<tempEnemy.length;i++){
                        bgMover(tempEnemy[i]);
                    } 
                }               
            }
        }
      function bgMover(e){
          e.y += e.speed;
          e.style.top = e.y + "px";
      }


        const scoreupdate = () =>{
            scoreOutput.textContent = player.score;
            badLeft.textContent = player.totalBad;
        }
        function pressKeyOn(event){
            event.preventDefault();
            keys[event.key] = true;
        }
       function pressKeyOff(event){
            event.preventDefault();
            keys[event.key] = false;
        }
        

    </script>
</body>
</html>